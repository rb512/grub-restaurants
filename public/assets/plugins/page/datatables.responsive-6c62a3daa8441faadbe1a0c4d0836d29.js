/**
 * File:        datatables.responsive.js
 * Version:     0.1.2
 * Author:      Seen Sai Yang
 * Info:        https://github.com/Comanche/datatables-responsive
 *
 * Copyright 2013 Seen Sai Yang, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD style license.
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * You should have received a copy of the GNU General Public License and the
 * BSD license along with this program.  These licenses are also available at:
 *     https://raw.github.com/Comanche/datatables-responsive/master/license-gpl2.txt
 *     https://raw.github.com/Comanche/datatables-responsive/master/license-bsd.txt
 */
"use strict";function ResponsiveDatatablesHelper(t,e){this.tableElement="string"==typeof t?$(t):t,this.columnIndexes=[],this.columnsShownIndexes=[],this.columnsHiddenIndexes=[],this.expandColumn=void 0,this.breakpoints={},this.expandIconTemplate='<span class="responsiveExpander"></span>',this.rowTemplate='<tr class="row-detail"><td><ul><!--column item--></ul></td></tr>',this.rowLiTemplate='<li><span class="columnTitle"><!--column title--></span>: <!--column value--></li>',this.disabled=!1,this.skipNextWindowsWidthChange=!1,this.init(e)}ResponsiveDatatablesHelper.prototype.init=function(t){var e=[];_.each(t,function(t,n){e.push({name:n,upperLimit:t,columnsToHide:[]})}),e=_.sortBy(e,"upperLimit");var n=void 0;_.each(e,function(t){t.lowerLimit=n,n=t.upperLimit}),e.push({name:"default",lowerLimit:n,upperLimit:void 0,columnsToHide:[]});for(var i=0;i<e.length;i++)this.breakpoints[e[i].name]=e[i];for(var r=this.tableElement.fnSettings().aoColumns,i=0;i<r.length;i++)r[i].bVisible&&this.columnIndexes.push(i);var a=$("thead th",this.tableElement);_.each(a,function(t,e){"expand"===$(t).attr("data-class")&&(this.expandColumn=e);var n=$(t).attr("data-hide");if(void 0!==n){var i=n.split(/,\s*/);_.each(i,function(t){void 0!==this.breakpoints[t]&&this.breakpoints[t].columnsToHide.push(this.columnIndexes[e])},this)}},this);var s=this;$(window).bind("resize",function(){s.respond()})},ResponsiveDatatablesHelper.prototype.respond=function(){if(!this.disabled){var t=$(window).width(),e=0,n=[];_.each(this.breakpoints,function(e){(!e.lowerLimit||t>e.lowerLimit)&&(!e.upperLimit||t<=e.upperLimit)&&(n=e.columnsToHide)},this);var i=!1;if(!this.skipNextWindowsWidthChange)if(this.columnsHiddenIndexes.length!==n.length)i=!0;else{var r=_.difference(this.columnsHiddenIndexes,n).length,a=_.difference(n,this.columnsHiddenIndexes).length;i=r+a>0}if(i&&(this.skipNextWindowsWidthChange=!0,this.columnsHiddenIndexes=n,this.columnsShownIndexes=_.difference(this.columnIndexes,this.columnsHiddenIndexes),this.showHideColumns(),e=this.columnsHiddenIndexes.length,this.skipNextWindowsWidthChange=!1),this.columnsHiddenIndexes.length){this.tableElement.addClass("has-columns-hidden");var s=this;$("tr.detail-show",this.tableElement).each(function(t,e){var n=$(e);0===n.next(".row-detail").length&&ResponsiveDatatablesHelper.prototype.showRowDetail(s,n)})}else this.tableElement.removeClass("has-columns-hidden"),$("tr.row-detail").remove()}},ResponsiveDatatablesHelper.prototype.showHideColumns=function(){for(var t=0,e=this.columnsShownIndexes.length;e>t;t++)this.tableElement.fnSetColumnVis(this.columnsShownIndexes[t],!0,!1);for(var t=0,e=this.columnsHiddenIndexes.length;e>t;t++)this.tableElement.fnSetColumnVis(this.columnsHiddenIndexes[t],!1,!1);var n=this;$("tr.row-detail").remove(),this.tableElement.hasClass("has-columns-hidden")&&$("tr.detail-show",this.tableElement).each(function(t,e){ResponsiveDatatablesHelper.prototype.showRowDetail(n,$(e))})},ResponsiveDatatablesHelper.prototype.createExpandIcon=function(t){if(!this.disabled){var e=$("td",t);if(void 0!==this.expandColumn&&this.expandColumn<e.length){var n=$(e[this.expandColumn]);0==$("span.responsiveExpander",n).length&&(n.prepend(this.expandIconTemplate),n.on("click","span.responsiveExpander",{responsiveDatatablesHelperInstance:this},this.showRowDetailEventHandler))}}},ResponsiveDatatablesHelper.prototype.showRowDetailEventHandler=function(t){if(!this.disabled){var e=$(this).closest("tr");e.hasClass("detail-show")?ResponsiveDatatablesHelper.prototype.hideRowDetail(t.data.responsiveDatatablesHelperInstance,e):ResponsiveDatatablesHelper.prototype.showRowDetail(t.data.responsiveDatatablesHelperInstance,e),e.toggleClass("detail-show"),t.stopPropagation()}},ResponsiveDatatablesHelper.prototype.showRowDetail=function(t,e){var n=t.tableElement,i=n.fnSettings().aoColumns,r=$(t.rowTemplate),a=$("ul",r);_.each(t.columnsHiddenIndexes,function(r){var s=$(t.rowLiTemplate);$(".columnTitle",s).html(i[r].sTitle),s.append(n.fnGetData(e[0],r)),a.append(s)});var s=t.columnIndexes.length-t.columnsHiddenIndexes.length;$("td",r).attr("colspan",s),e.after(r)},ResponsiveDatatablesHelper.prototype.hideRowDetail=function(t,e){e.next(".row-detail").remove()},ResponsiveDatatablesHelper.prototype.disable=function(t){this.disabled=void 0===t||!0,this.disabled&&($("tbody tr.row-detail",this.tableElement).remove(),$("tbody tr",this.tableElement).removeClass("detail-show"),$("tbody tr span.responsiveExpander",this.tableElement).remove(),this.columnsHiddenIndexes=[],this.columnsShownIndexes=this.columnIndexes,this.showHideColumns(),this.tableElement.removeClass("has-columns-hidden"),this.tableElement.off("click","span.responsiveExpander",this.showRowDetailEventHandler))};